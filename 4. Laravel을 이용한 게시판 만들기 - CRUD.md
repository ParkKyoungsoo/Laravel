# Laravel을 이용한 게시판 만들기 - CRUD

이제 게시판의 화면을 꾸며보자



일반적인 게시판의 경우 글번호, 제목, 작성자, 작성 시간이 나타난다.

아래는 index.blade.php 의 예시이다.

```php+HTML
@extends('layout')

@section('content')
<link rel="stylesheet" type="text/css" href="css/style.css">
<div class="content">
  <table>
    <thead>
      <tr>
        <th class="table_no">No.</th>
        <th class="table_title">제목</th>
        <th class="table_writer">작성자</th>
        <th class="table_write_time">작성시간</th>
      </tr>
    </thead>
    <tbody class="table_content">
      @foreach($boards as $board)
        <tr>
          <td class="table_no">{{$board['_no']}}</td>
          <td class="table_title">
            {{$board['title']}} 
          </td>
          <td class="table_writer">{{$board['writer']}}</td>
          <td class="table_write_time">{{$board['reg_date']}}</td>
        </tr>
      @endforeach
    </tbody>
  </table>
</div>
@endsection
```



`<link rel="stylesheet" type="text/css" href="css/style.css">` 코드를 통해 css파일을 불러 올 수 있다.

프로젝트 -> public -> css 폴더 내에 위치해 있다.

![image-20210407153647391](C:\Users\DESKTOP\AppData\Roaming\Typora\typora-user-images\image-20210407153647391.png) 



CSS에 대한 설명은 하지 않는다.

```css
/* style.css */
.header,
.content {
  margin: 30px 200px;
  text-align: center;
}

.list_option {
  display: flex;
  justify-content: flex-end;
}

.content table {
  width: 100%;
  border-collapse: collapse;
}

.content table th {
  border-top: 2px solid black;
  border-bottom: 2px solid black;
}

th,
td {
  padding: 0 10px;
}

.table_no {
  width: 10%;
  height: 50px;
}

.table_content {
  width: 75%;
}

.table_content > tr > td {
  border-bottom: 1px solid #797979;
}
tbody > tr > .table_title {
  text-align: left;
  padding-left: 20px;
}

tbody > tr > .table_title:hover {
  background-color: rgb(163, 163, 163);
}

tbody > tr > .table_title > a {
  color: black;
  text-decoration: none;
}

.table_writer {
  width: 10%;
  font-size: 10px;
}

.table_write_time {
  width: 5%;
  font-size: 5px;
}
```





### 특정 글 조회하기(Read)

게시판 목록에서 각 글을 클릭하면 해당 글로 넘어가야 한다.



이때 MVC 요소별 역할을 얘기하면

<img src="https://user-images.githubusercontent.com/44697835/113824428-bfa67300-97ba-11eb-8634-b17b9d8ebffb.png" width="500px;">

라고 볼 수 있다.



 view에서 클릭했을때 Controller부분에 몇번글인지를 넘겨주는 부분을 만들어보자.

```php+HTML
//index.blade.php

// 생략
  @foreach($boards as $board)
    <tr>
      <td class="table_no">{{$board['_no']}}</td>
      <td class="table_title"
        onClick='location.href="{{route('view' ,['no' => $board['_no']])}}"'>
        {{$board['title']}} 
      </td>
      <td class="table_writer">{{$board['writer']}}</td>
      <td class="table_write_time">{{$board['reg_date']}}</td>
    </tr>
  @endforeach
// 생략

```

`route('{name}')`는  지정된 route 로의 URL을 생성한다.  또한, 두번째 인자로 넘길 파라미터를 지정 할 수 있다.

`route('view' ,['no' => $board['_no']])`는 view라고 지정된 라우터 URL 을 생성하면서, no= $board['_no'] 를 넘겨준다.

최종적으로 `사이트주소/{라우터에서 지정한 url}?no=$board['_no']`가 생성이 되는것이다.

[https://laravel.com/docs/8.x/helpers#method-route](https://laravel.com/docs/8.x/helpers#method-route)



이제 라우터를 만들어 보자

```php
<?php
// web.php

use App\Http\Controllers\BoardController;
use Illuminate\Support\Facades\Route;

Route::get('/', [BoardController::class, 'searchAll']);

Route::get('view', [BoardController::class, 'viewPost'])->name('view');
```



#### Named Routes

Named Route를 사용하면 특정 경로에 대한 URL 또는 Redirects를 편하게 할 수 있다. `name()`메소드를 Route정의에 연결해서 Route의 이름을 지정 할 수 있다.

```php
Route::get('/user/profile', function () {
    //
})->name('profile');
```

`Route::get('view', [BoardController::class, 'viewPost'])->name('view')` 를 통해 BoardController의 viewPost 액션에 대한 라우터의 이름(view)을 지정 하였다.

[Named Routes](https://laravel.com/docs/8.x/routing#named-routes)





#### Controller

Controller에서는 Model을 통해 특정 글을 조회한 뒤, 이를 View에게 리턴해준다.

```php
<?php
// BoardController.php

namespace App\Http\Controllers;

use App\Models\Boards;
use Illuminate\Http\Request;

// Boards 모델을 사용한다

class BoardController extends Controller
{
    // 모든 게시글을 호출하는 함수를 만든다
    public function searchAll()
    {
		// 생략
    }

    public function viewPost(Request $request)
    {
        $post = Boards::where('_no', $request->no)->first();
        return view('post', ['post' => $post]);
    }
}
```



'`ndex.blade.php`에서 HTTP Method인 GET으로 요청을 보냈기 때문에 HTTP Request로 부터 값을 받아 올 수 있다.

자세한 사항은 [공식문서](https://laravel.com/docs/8.x/requests#accessing-the-request)를 참고하자.



`$post = Boards::where('_no', $request->no)->first();`에서 `first();`는 DB테이블에서 하나의 row를 가져온다. 이 메소드는 stdClass를 반환한다. 덕분에 각 컬럼의 값에 접근 할 수 있다.

 `ex : $post['title']로 title column값을 확인 할 수 있다.`

[Laravel - Retrieving All Rows From A Table](https://laravel.com/docs/8.x/queries#retrieving-all-rows-from-a-table)



`return view('post',['post' => $post]);`에서 post(앞)라는 view에게 post(가운데)로 $post(뒤)를 전달하기 때문에 post라는 이름의 view페이지가 필요하다.

<img src="https://user-images.githubusercontent.com/44697835/113838255-904b3280-97c9-11eb-9774-ca64d3c5a163.png" width="300px">



#### View

이제 post 라는 view페이지를 만들자. 이 페이지에서는 글의 제목, 내용, 작성자, 작성시간을 보여줄것이다.

```php+HTML
// post.blade.php
@extends('layout')

@section('content')
<link rel="stylesheet" type="text/css" href="css/postStyle.css">
  <div class="article_header">
    <div class="article_title">
      {{$post['title']}}
    </div>
    <div class="article_info">
      <div class="writer">{{$post['writer']}}</div>
      <div class="write_time">{{$post['reg_date']}}</div>
    </div>
  </div>
  <div class="content">
    <div class="article">
      {{$post['content']}}
    </div>
  </div>
@endsection

```



사용된 css

```css
/* postStyle.css */
.article_header,
.content {
  margin: 30px 200px;
  padding: 10px;
}

.article_header {
  height: 70px;
  border-top: 1px solid black;
  border-bottom: 1px solid black;
}

.article_title {
  height: 70%;
  font-weight: bold;
  font-size: 20px;
}

.article_info {
  height: 30%;
  display: flex;
  justify-content: flex-end;
  font-size: 10px;
}

.article_info > .writer,
.write_time {
  padding: 0 5px;
}

.content {
  --parentHeight: 500px;
  min-height: var(--parentHeight);
  border-bottom: 1px solid black;
}

.content > .article {
  height: calc(var(--parentHeight) * 0.95);
}

.content > .tool {
  display:flex;
  justify-content: flex-end;
  height: calc(var(--parentHeight) * 0.05);
}

.footer {
  display: flex;
  justify-content: center;
}
```



이제 게시판 목록에서 각 글들을 클릭하면 해당 글의 페이지로 이동할 수 있다.

웹페이지 상에서 뒤로가기를 누르면 목록으로 돌아갈 수 있지만, 편의를 위하 `목록으로` 버튼을 만들어보자.



```php+HTML
// post.blade.php
// 생략

  <div class="footer">
    <button onClick="location.href='{{route('index')}}'">목록으로</button>
  </div>
@endsection
```



```php
// web.php
// 생략
Route::get('/', [BoardController::class, 'searchAll'])->name('index');
// 생략
```

처음 화면을 나타내는 Route의 이름을 index로 지정한 뒤 `목록으로`버튼을 누르면 초기페이지로 이동한다.



### 글 작성하기(CREATE)

이제부터는 게시글을 작성해서 등록할 것이다. 아래는 게시글 작성 페이지 이다.(여기서부터는 CSS가 없다.)

##### View

```php+HTML
// createPost.blade.php
@extends('layout')
@section('content')
  <div>
    <form method="POST" action="{{route('create')}}">
      @csrf
      <div>
        <input type="text" name="title" placeholder="글 제목을 입력하세요">
      </div>
      <div>
        <textarea name="contents"></textarea>
      </div>
      <div>
        <input type="text" name="writer" placeholder="작성자">
      </div>
      <div>
        <button type="submit">완료</button>
      </div>
    </form>
  </div>
@endsection
```



HTML form 형식으로 게시글들을 작성 한 뒤, POST요청으로 create라는 라우터에 보낼 것이다.

이때 각 입력들은 name의 변수명으로 접근이 가능하다. 이는 Controller에서 다룰 것이다. 



##### Route

```php
// web.php
// 생략
Route::get('/create',function() {
	return view('createPost'); 
});

Route::post('create', [BoardController::class, 'createPost'])->name('create');
```

`사이트주소/create` 이하로 접근했을때 `createPost`페이지를 리턴한다. 

`createPost`페이지에서 작성한 게시글은 POST 요청이기 때문에 이전과 다르게 `Route::get`이 아닌 `Route::post`로 사용한다.



##### Controller

```php
// BoardController.php
<?php

// 생략

class BoardController extends Controller
{
	// 생략
    public function createPost(Request $request)
    {
        $title = $request->title;
        $contents = $request->contents;
        $writer = $request->writer;

        $boards = new Boards;
        $boards->title = $title;
        $boards->content = $contents;
        $boards->writer = $writer;
        $boards->save();

        return redirect()->route('index');
    }
}

```



`post.blade.php`(이하 `post`View)에서 글 제목은 `name="title"` , 내용은 `name="contents"`, 작성자는 `name="writer"`로 지정했기 때문에 `Request $request`를 통해 각각 `$request->title`,`$request->contents`,`$request->writer`로 접근 할 수 있다.



